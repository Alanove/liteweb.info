function buttonsInit(){$("button").bind("mousedown",function(){$(this).addClass("mousedown")}),$("button").bind("mouseup",function(){$(this).removeClass("mousedown")})}top.lw=lw,lw.manager={user:null,header:null,sprite:null,menu:null,main:null,activeArea:null,activeSection:null,sections:{},search:null,xml:null,query:null,menuDuration:300,_an:0,an:function(){return lw.manager._an++},init:function(n){var t=lw.manager,i;t.user=n,t.header=$("header"),t.xml=$($(t.user.xml)[1]),i=$("<h2>Welcome {0}!<\/h2>".Format(n.Name)),i.css("opacity",0),t.header.find("form").fadeOut(300,function(){t.header.find("form").remove(),t.header.find("aside").append(i),i.animate({opacity:1},300)}),t.header.animate({height:85},300),t.header.find(".logo").animate({height:48},300),t.header.find(".logo img").animate({width:213},300),t.header.find(".logo img").attr("src","images/logo-small.png"),$(".logout").removeClass("hidden").css({opacity:0}).delay(300).animate({opacity:1},300),$(".welcome-note").fadeOut(300,function(){$(".welcome-note").remove()}),$(".video").fadeOut(300,function(){$(".video").remove()}),t.sprite=$("footer .sprite"),t.sprite.removeClass("hidden").css({bottom:-70}).delay(0).animate({bottom:0},300),t.menu=$(".content .menu"),t.main=$(".content .main"),t.activeArea=$(".content .active"),t.main.removeClass("hidden"),t.buildMenu(),t.onResize(),t.main.css({width:GetViewWidth()-20,height:GetViewHeight()-110,opacity:0}).delay(300).animate({opacity:1},300),$(window).bind("resize",t.onResize),t.initSearch(),$.history.init(function(n){var i=lw.manager,r,t,u;for(n=n.replace(/-d$/,""),r=n.split("&"),i.query={},t=0;t<r.length;t++)r[t].Trim()!=""&&(u=r[t].Trim().split("="),u.length==2&&(i.query[u[0].Trim()]=u[1].Trim()));i.query.section||(i.query.section="ZONESANDSCREENS"),lw.manager.initSection(),lw.manager.initTab()}),$(".broadcast").click(function(){lw.popup($(".add-items"))})},initSearch:function(){var n=lw.manager;n.search=$("section.search"),n.search.css({display:"none",opacity:0}),n.search.animate({opacity:1},300),n.search.field=$("section.search .f input[name=q]"),n.search.button=$("section.search .f input[type=button]"),n.search.advanced=$("section.search .f a"),n.search.emptyText="Type your search here...",n.search.field.val(n.search.emptyText),lw.utils.fieldMask(n.search.field,n.search.emptyText)},initSection:function(){var n=lw.manager,u=n.query.section||"Home",t=n.sections[u],s,r,e,o;if(n.activeSection==u){t.ul&&t.ul.children().removeClass("_active"),t.panel.css("display","block"),t.sprite.css("display","block"),n.initSubSection();return}n.hideActiveSection(),n.activeSection=u;var i=t.li,f=i.data("_active"),h=i.data("div");f.data("child-bind")||(f.data("child-bind",!0),s=$(i.data("node")).children(),r=$("<ul />"),s.each(function(){var f;if(!(["new","edit","delete"].indexOf(this.nodeName.toLowerCase())>=0)){var i=$("<li />"),e=n.GetText(this),o=$("<a />").html(e);i.data("node",this),o.attr("href","#section="+u+"&sub="+this.nodeName),i.addClass(this.nodeName),i.append(o),n.hasPermission(this,"new")&&!1&&(f=$("<a class=new>+<\/a>"),f.attr("href","#section="+u+"&action=new&sub="+this.nodeName),i.append(f)),t.subs[this.nodeName]={li:i,name:e},r.append(i)}}),r.children().length>0&&(f.append(r),i.data("children",r),t.ul=r)),e=i.data("children"),isOk(e)?(o=i.width(),i.css("width",o+2),f.css({display:"block",opacity:0}).delay(n.menuDuration/3).animate({opacity:1,height:e.height()+26},{duration:n.menuDuration,complete:function(){}}),i.animate({height:e.height()+30},{duration:n.menuDuration,complete:function(){i.css("width",o)}}),t.ul&&t.ul.children().removeClass("_active")):f.css({display:"block",opacity:0}).animate({opacity:1},{duration:n.menuDuration}),h.delay(n.menuDuration/3).animate({opacity:0},{duration:n.menuDuration,complete:function(){n.initSubSection()}}),t.panel||n.createPanel(t),t.panel.css("display","block"),t.sprite.css("display","block")},initSubSection:function(){var i=lw.manager,t=i.query.sub,f=i.query.action,n=i.sections[i.activeSection],u,r;isOk(n.subs[t])&&isOk(n)&&(n.oldSub&&n.oldSub!=t&&(n.ul.find("."+n.oldSub).removeClass("_active"),n.ul.find("."+n.oldSub).find("a").removeClass("_active")),n.oldSub=t,u=n.subs[t],isOk(t)&&(r=n.ul.find("."+t).addClass("_active"),r.find("a").addClass("_active")))},createPanel:function(n){var r=lw.manager,t=$("<div />"),i;t.addClass("panel").addClass(n.nodeName),r.activeArea.append(t),n.panel=t,i=$("<div />"),i.appendTo(r.sprite),n.sprite=i},initTab:function(){var n=lw.manager,t=n.query.tab||n.query.section+(isOk(n.query.sub)?"-"+n.query.sub:"")+(isOk(n.query.action)?"-"+n.query.action:"");n.createTab(t,n.sections[n.query.section],n.query.sub)},createTab:function(n,t,i){var f=lw.manager,r,h,e,s,u,c,l,a;if(typeof n=="object"?(r=n.tabName,s=n.tabText,t=n.section,i=n.sub,e=n.path,u=n.currentNode):r=n,r=lw.utils.toId(r),t.panel||f.createPanel(t),t.tabs||(t["tabs-panels"]=$("<section class=tabs/>").appendTo(t.panel),t.tabs=$("<ul />").appendTo(t["tabs-panels"]),t.tabsindex={},t["tabs-queue"]=[]),!isOk(t.tabsindex[r])){if(isOk(e)||(e="main>{0}".Format(t.nodeName),isOk(i)&&(e=e+">"+i)),!isOk(u)&&(u=f.xml.find(e),isOk(u.attr("justmenu")))){u=$(u.children()[0]),i=f.query.sub=u[0].nodeName,f.initSubSection(),f.initTab();return}var o=$("<li/>").attr("name",r),y=$("<span />").appendTo(o),v=$('<a class=close title="Close Tab"/>').appendTo(y);v.attr("href","#close=tab"),v.click(f.closeTab),isOk(s)||(s=f.GetText(u)),c=$("<a class=tab/>").html(s).appendTo(o),c.attr("href","#section={0}&sub={1}&tab={2}".Format(t.nodeName,isOk(i)?i:"",r)),lw.tabTimeout&&clearTimeout(lw.tabTimeout),lw.tabTimeout=setTimeout(function(){top.location.href=c.attr("href")},100),t.tabs.append(o),l=$("<div />").addClass("tab-panel").appendTo(t["tabs-panels"]),h=e.replace(/>/ig,"/"),a=$("<iframe />").attr("src",h).appendTo(l),a.bind("load",function(){this.contentDocument.tabInfo={tabName:r,tabText:s,path:e,sub:i,currentNode:u,section:t,url:h}}),o.data("div",l),o.data("iframe",a),t.tabsindex[r]=o}f.activateTab(t,r)},closeTab:function(){var t=lw.manager,n=t.sections[t.activeSection],i=n["tabs-queue"],r=$(this).parents("li").attr("name"),u=n.tabsindex[r],f,o,s,e;if(isOk(u))return f=u.data("div"),o=u.hasClass("_active"),f&&f.remove(),u.remove(),delete n.tabsindex[r],i.length>1&&o?(s=i[i.length-2],location.href=n.tabsindex[s].children("a").attr("href")):t.onResize(),e=[],$.each(i,function(){this!=r&&e.push(this)}),n["tabs-queue"]=e,t.sprite.find("div#buttons_"+r).remove(),!1},activateTab:function(n,t){var i=lw.manager,r=[];$.each(n["tabs-queue"],function(){if(this!=t&&(r.push(this),n.tabsindex[this])){var u=n.tabsindex[this];u.removeClass("_active"),u.data("div").css("display","none"),i.sprite.find("div#buttons_"+this).hide()}}),r.push(t),n["tabs-queue"]=r,n.tabsindex[t].addClass("_active"),n.tabsindex[t].data("div").css("display","block"),i.sprite.find("div#buttons_"+t).show(),i.onResize()},hideActiveSection:function(){var n=lw.manager,r=n.activeSection;if(isOk(r)){var t=n.sections[r],i=t.li,u=i.data("_active"),f=i.data("div");i.delay(n.menuDuration/3).animate({height:30},n.menuDuration),u.animate({opacity:0},n.menuDuration),f.animate({opacity:1},n.menuDuration),t.panel&&t.panel.css("display","none"),t.sprite&&t.sprite.css("display","none")}},onResize:function(){var n=lw.manager;n.main.css({height:GetViewHeight()-110,width:GetViewWidth()-20}),n.menu.css({height:GetViewHeight()-110}),n.activeArea.css({height:GetViewHeight()-110,width:GetViewWidth()-n.menu.width()-20});var f=n.activeArea.width(),e=n.activeArea.height(),t=n.sections[n.activeSection];if(isOk(t)&&isOk(t.tabs)){var i=t.tabs.children("li"),r=0,u=1;i.each(function(t){var o=$(this),s;o.css({left:r,position:"absolute","z-index":10+t*u}),r+=o.width()-20,o.hasClass("_active")&&(o.css("z-index",1e3),u=-1),s=o.data("iframe"),s.width(f-7),s.height(e-n.sprite.height()-i.height()-14)})}},buildMenu:function(){var n=lw.manager,t=$("<ul>"),i=n.xml.find("main").children();i.each(function(){var i=n.createMenuButton(this,t);n.sections[this.nodeName]={li:i,subs:{},name:n.GetText(this),nodeName:this.nodeName}}),n.menu.append(t),n.menu.delay(300).animate({opacity:1},300)},createMenuButton:function(n,t){var s=lw.manager,h=s.GetText(n),e=typeof n=="string"?n:n.nodeName,i=$("<li />"),r,u,o,f;return i.data("node",n),i.addClass(e),r=$("<div />"),u=$("<a />").html(h),u.bind("click",lw.manager.menuButtonAction),u.attr("href","#section="+e),r.append(u),s.hasPermission(n,"new")&&!1&&(o=$("<a class=new>+<\/a>"),o.attr("href","#section="+e+"&action=new"),r.append(o)),f=r.clone(!0),f.addClass("_active"),i.append(r,f),i.data("div",r),i.data("_active",f),t.append(i),i},hasPermission:function(n){var t=$(n).children("new");return t.length>0},menuButtonAction:function(){},GetText:function(n){if(typeof n=="string")return n;var t="";return t=$(n).attr("Text"),t&&t.trim()||!n.nodeName||(t=n.nodeName),isOk(t)?t.trim():""},registerframe:function(){},createButtons:function(n,t,i){var f=lw.manager,r="buttons_{0}".Format(lw.utils.toId(i)),u;f.sprite.find("#"+r).length>0&&f.sprite.find("#"+r).remove(),u=$('<div id="{0}"/>'.Format(r)),$.each(t,function(){var n=$("<button />").html("<span>"+this.text+"<\/span>");n.addClass(this.css).on("click",this.action);n.appendTo(u)}),u.appendTo(n.sprite)}};
//@ sourceMappingURL=manager.min.js.map